<!DOCTYPE html>
<html lang="en">
<head>
        <title>Why Not Wingnut? - scrapers</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
                <link href="http://qalthos.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Why Not Wingnut? Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie.css"/>
                <script src="../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../">Why Not Wingnut? </a></h1>
                <nav><ul>
                                                                                                    <li ><a href="../category/civx.html">CIVX</a></li>
                                    <li ><a href="../category/fossrit.html">FOSS@RIT</a></li>
                                    <li ><a href="../category/meta.html">meta</a></li>
                                    <li ><a href="../category/personal.html">personal</a></li>
                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../back-up-to-speed.html">Back up to Speed</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2011-06-21T22:56:00">
                Tue 21 June 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/nathaniel-case.html">Nathaniel Case</a>
        </address>
        <p>In <a href="../category/civx.html">CIVX</a>. </p>
<p>tags: <a href="../tag/peopledashboard.html">peopledashboard</a><a href="../tag/widgets.html">widgets</a><a href="../tag/scrapers.html">scrapers</a><a href="../tag/surs.html">SURS</a></p>
</footer><!-- /.post-info --><p>I've almost closed <a class="reference external" href="https://fedorahosted.org/civx/ticket/106">bug #106</a>. I've done all I can do for now, until I
can figure out how to attribute actions to senators. Until then, I
should comment out the 'actions' tab tomorrow with a note letting
whoever tries this next what I've already tried.
There is still some work to do in this code, particularly with fixing
the hacky Assembly scraping I wrote last year which also broke. However,
considering that the Assembly is not currently one of the bits we are
trying to expose (and they don't have a nice public API like the
Senate), it probably won't get done for a little while.
When I left yesterday, I had exposed the senator's social page, but none
of the other tabs were showing up. The problem for this turned out to be
that the image representing the tab was corrupted and the text beneath
it was white, making it overall look like the tab was invisible. Once I
got a new image for the tab, they all suddenly appeared, though only the
bills had any information.
The next thing to fix was the scraping of the committees, whose pages
had also changed subtly in the past few months. Fixing this was much
less annoying than building them the first time, and I was able to
remove a lot of old shims in the code from when I was first being
introduced to <a class="reference external" href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a>. Some of my later changes made this
particularly easy, and since BeautifulSoup is so powerful, I was able to
restore access to the data with relative ease. As a bonus, as soon as I
had committees back up, the tabs for votes and meetings came with it for
free. Suddenly, I was almost there!
The final problem I encountered today is actually not a new one, but one
we struggled with last year, and one I now feel confident I have
actually fixed and understand now. Once I got all the data pulling
again, a few of the pages would crash the server with
UnicodeDecodeErrors.
As a warning, some heavy Python is about to come down
UnicodeDecodeError is an error which happens (generally) when attempting
to decode a string into a Unicode object. This is generally a great
thing to do, as Python strings are generally encoded in the relatively
restrictive ASCII, which does not have characters for any of the more
exciting characters like accents and non-latin symbols. Unicode has no
such restrictions, and indeed has data for many, many more symbols, at
the cost of a few more bits of storage per character.
So why were we getting this error? The relevant line of code was 's =
unicode(s)' and was contained within <a class="reference external" href="http://pythonpaste.org/webob/#introduction">WebOb</a> code, not something I was
going to be able to modify successfully. Still, even this shouldn't be a
problem. The purpose of this function is to turn strings to Unicode
strings.
Except I didn't have a string, I already had a Unicode string.
Even this shouldn't be a problem, except that unicode() tries to
interpret its input as a string and then turn it into a Unicode string.
And while Unicode strings can be easily represented as normal strings,
the default of the unicode() function is to try to interpret those
strings as ASCII strings, and I had accents in the strings. These
strings were representing the names of the senators, so I had to make
sure it came out right.
In order to solve this, I had to reversibly represent these names as a
sequence of ASCII characters.
There are a few ways to replace out-of-bound characters when changing
strings into lesser encodings, and I had two useful ones to chose from.
The obvious one to chose was to change the characters into XML character
entities, however this quickly turned out to be insufficient. While
&amp;#233; correctly showed up as Ã© on the page, this string is used to
represent the name everywhere, including in the internal URL
representing the page. And the ampersand was quickly stripped out as a
broken argument to the URL, leading to a page for a nonexistent Senator.
Looking through the code, there were three distinct uses for the name
string. The first, which had started all this, was as an ASCII key to a
dictionary which needed to be authoritative but not necessarily
accurate. In other words, I needed it to be the same everywhere, but it
didn't necessarily need to be the correct name of the senator. The
second was the use on the generated web page, which needed to be as
accurate as possible to the Senator's actual name, as it is going to be
viewed publicly. The third, and the current stickler was the name in the
URL. Again, this had to be authoritative but not necessarily accurate.
This one, however, had to also only include web-safe characters, of
which &amp;, # and ; do not qualify.
I mulled this over for a while, thinking up more and more elaborate
schemes for intercepting the names before they reached critical areas,
but none of it was terribly good coding practice. After far too much
thinking, I realized the obvious answer: have separate internal and
external names. The system still relies on the senator's name, which is
still a questionable practice given the multiple spellings of names that
occasionally pop up, (but mostly because I remember <a class="reference external" href="http://www.kalzumeus.com/2010/06/17/falsehoods-programmers-believe-about-names/">this post</a>, which
is something you should always keep in mind when programming around
names. The display name, on the other hand, has none of the restrictions
on characters (though it still needs to be ASCII to display properly),
but by using XML entities, we can make any character we want without
problems.
This was a long path to take to get back to where we were, but I think
that I really understand Python's Unicode in a way I never grasped
before. This should definitely help in the future as Unicode is a very
important part of coding portable applications and that's something I
want to do.</p>
                </article>
                            </aside><!-- /#featured -->
                            <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">
                                                

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../shelves-and-shoves.html" rel="bookmark"
                           title="Permalink to Shelves and Shoves">Shelves and Shoves</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2011-06-21T22:56:00">
                Tue 21 June 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/nathaniel-case.html">Nathaniel Case</a>
        </address>
        <p>In <a href="../category/civx.html">CIVX</a>. </p>
<p>tags: <a href="../tag/peopledashboard.html">peopledashboard</a><a href="../tag/widgets.html">widgets</a><a href="../tag/scrapers.html">scrapers</a><a href="../tag/surs.html">SURS</a></p>
</footer><!-- /.post-info -->                <p>Today is the day to hit <a class="reference external" href="https://fedorahosted.org/civx/ticket/105">bug #105</a>, another of the leftover bugs from
last year.
The story goes something like this: there's a lot of data on
nysenate.gov that is nice to have, but asking for that info on every
call is a little cumbersome. We want ...</p>
                <a class="readmore" href="../shelves-and-shoves.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../the-last-week.html" rel="bookmark"
                           title="Permalink to The Last Week">The Last Week</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2011-06-21T22:56:00">
                Tue 21 June 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/nathaniel-case.html">Nathaniel Case</a>
        </address>
        <p>In <a href="../category/civx.html">CIVX</a>. </p>
<p>tags: <a href="../tag/peopledashboard.html">peopledashboard</a><a href="../tag/widgets.html">widgets</a><a href="../tag/scrapers.html">scrapers</a><a href="../tag/surs.html">SURS</a><a href="../tag/fabulous.html">fabulous</a></p>
</footer><!-- /.post-info -->                <p>This week has been a mess for a lot of reasons. Let's see what I managed
to get through so far.
One of the things I got to look at this week is threebean's mokshactl
branch of CIVX and Moksha. This is a project to simplify the
administration ...</p>
                <a class="readmore" href="../the-last-week.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../grokking-the-core.html" rel="bookmark"
                           title="Permalink to Grokking the Core">Grokking the Core</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2011-06-21T22:55:00">
                Tue 21 June 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/nathaniel-case.html">Nathaniel Case</a>
        </address>
        <p>In <a href="../category/civx.html">CIVX</a>. </p>
<p>tags: <a href="../tag/scrapers.html">scrapers</a><a href="../tag/surs.html">SURS</a><a href="../tag/polyscraper.html">polyscraper</a></p>
</footer><!-- /.post-info -->                <p>This week begins the real dive into the core of what makes CIVX. Today
(and yesterday, though yesterday hardly counts as a real day) were spent
adding major functionality to the polyscraper, something that's been
overdue for a long time now.
But what is this magical polyscraper? Well, in ...</p>
                <a class="readmore" href="../grokking-the-core.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../diving-deep.html" rel="bookmark"
                           title="Permalink to Diving Deep">Diving Deep</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2010-09-09T18:11:00">
                Thu 09 September 2010
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/nathaniel-case.html">Nathaniel Case</a>
        </address>
        <p>In <a href="../category/civx.html">CIVX</a>. </p>
<p>tags: <a href="../tag/scrapers.html">scrapers</a></p>
</footer><!-- /.post-info -->                <p>Yesterday had been spent working on a proper dev branch to CIVX. Today
we gave it a home.
Today started off trying to get the current dev CIVX running on our
server. Now, I had some experience setting up a CIVX instance from
getting one running on my box, but ...</p>
                <a class="readmore" href="../diving-deep.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            </ol><!-- /#posts-list -->
                            <p class="paginator">
        Page 1 / 1
    </p>
                        </section><!-- /#content -->
                    <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://foss.rit.edu">FOSS@RIT</a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                          <div class="tagcloud">
            <h2>tag cloud</h2>
            <ul>
                              <li class="tag-4"><a href="/tag/webbotwar.html">webbotwar</a></li>
                              <li class="tag-1"><a href="/tag/peopledashboard.html">peopledashboard</a></li>
                              <li class="tag-4"><a href="/tag/introspective.html">introspective</a></li>
                              <li class="tag-4"><a href="/tag/knowledge.html">knowledge</a></li>
                              <li class="tag-4"><a href="/tag/opl.html">OPL</a></li>
                              <li class="tag-1"><a href="/tag/wikiotics.html">wikiotics</a></li>
                              <li class="tag-4"><a href="/tag/jquery.html">jQuery</a></li>
                              <li class="tag-1"><a href="/tag/journalism.html">journalism</a></li>
                              <li class="tag-1"><a href="/tag/surs.html">SURS</a></li>
                              <li class="tag-4"><a href="/tag/blog.html">blog</a></li>
                              <li class="tag-1"><a href="/tag/widgets.html">widgets</a></li>
                              <li class="tag-2"><a href="/tag/openshift.html">openshift</a></li>
                              <li class="tag-1"><a href="/tag/sugar.html">sugar</a></li>
                              <li class="tag-1"><a href="/tag/hackfest.html">hackfest</a></li>
                              <li class="tag-3"><a href="/tag/data alchemy.html">data alchemy</a></li>
                              <li class="tag-4"><a href="/tag/rise.html">Rise</a></li>
                              <li class="tag-4"><a href="/tag/games.html">games</a></li>
                              <li class="tag-2"><a href="/tag/geowebdns.html">geowebdns</a></li>
                              <li class="tag-4"><a href="/tag/hardware.html">hardware</a></li>
                              <li class="tag-2"><a href="/tag/election.html">election</a></li>
                              <li class="tag-1"><a href="/tag/floss-seminar.html">FLOSS-seminar</a></li>
                              <li class="tag-2"><a href="/tag/democracymap.html">democracymap</a></li>
                              <li class="tag-1"><a href="/tag/lemonade.html">lemonade</a></li>
                              <li class="tag-1"><a href="/tag/scrapers.html">scrapers</a></li>
                              <li class="tag-4"><a href="/tag/boston.html">Boston</a></li>
                              <li class="tag-4"><a href="/tag/fabulous.html">fabulous</a></li>
                              <li class="tag-4"><a href="/tag/pybotwar.html">pybotwar</a></li>
                              <li class="tag-3"><a href="/tag/groovebot.html">groovebot</a></li>
                              <li class="tag-2"><a href="/tag/pydex.html">pyDex</a></li>
                              <li class="tag-3"><a href="/tag/polyscraper.html">polyscraper</a></li>
                          </ul>
          </div>
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://qalthos.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="http://github.com/Qalthos">Github</a></li>
                                                    <li><a href="http://gplus.to/qalthos">Google+</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>